<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PTE Practice ‚Äì Dictation & Situations</title>
  <style>
    :root{
      --brand:#003366;
      --brand-2:#0055a5;
      --ink:#222;
      --card:#fff;
      --bg:#f4f7fb;
      --info:#e6f7ff;
      --danger:#d93025;
      --accent:#ffcc00;
    }
    *{box-sizing:border-box}
    body { font-family: Arial, sans-serif; background: var(--bg); color:var(--ink); margin:0; }
    header {
      position: relative; background: var(--brand); color: #fff; padding: 16px; text-align: center;
    }
    header .home-btn-top {
      position: absolute; top: 16px; left: 16px;
      text-decoration: none; color: #fff; background: var(--brand-2);
      padding: 6px 12px; border-radius: 6px; font-size: 0.9rem;
    }
    header .home-btn-top:hover { background: #0077cc; }

    main {
      max-width: 1000px; margin: 20px auto; background: var(--card);
      padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 { color: var(--brand); margin: 16px 0 10px; }
    .question { margin-bottom: 20px; }
    .question label { font-weight: bold; display: block; margin-bottom: 6px; }
    textarea {
      width: 100%; min-height: 60px; padding: 10px;
      border: 1px solid #ccc; border-radius: 6px;
      font-size: 1rem; resize: vertical;
    }
    button {
      background: var(--brand); color: #fff; border: none;
      padding: 10px 18px; font-size: 0.95rem;
      border-radius: 6px; cursor: pointer; transition: background 0.3s ease;
    }
    button:hover { background: var(--brand-2); }
    .result-box, .results {
      margin-top: 12px; padding: 12px; background: var(--info); border-radius: 6px; display: none;
    }
    .optional { color: grey; font-style: italic; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; vertical-align: top; }
    .highlight { color: red; font-weight: bold; }

    /* ---------- Part 2 Compact Side-by-Side ---------- */
    #part2-frame{
      display:grid; grid-template-columns: 1fr minmax(240px, 320px); gap:18px; align-items:start;
    }
    #situations{ display:flex; flex-direction:column; gap:12px; }
    #options{
      display:flex; flex-direction:column; gap:12px;
      position:sticky; top:10px; /* stays visible while left side scrolls */
      max-height: calc(100vh - 140px); overflow:auto; padding-right:4px;
    }
    .match-item, .option{
      background:#fff; border:1px solid #dcdcdc; border-radius:8px; padding:12px;
      box-shadow:0 1px 4px rgba(0,0,0,0.08);
    }
    .match-item label{ display:block; font-weight:700; margin-bottom:6px; color:var(--brand); }
    .dropzone{
      margin-top:6px; padding:10px; border:2px dashed #ccc; border-radius:8px;
      min-height:44px; background:var(--bg); text-align:center; font-style:italic; color:#666;
    }
    .option{
      cursor:grab;
    }

    /* ---------- Square Audio Buttons (custom control) ---------- */
    .audio-row{ display:flex; align-items:center; gap:10px; }
    .sq-btn{
      width:56px; height:56px; min-width:56px; min-height:56px;
      border-radius:12px; border:none; background:var(--brand);
      color:#fff; font-size:22px; line-height:1; display:inline-flex; align-items:center; justify-content:center;
      cursor:pointer;
    }
    .sq-btn:hover{ background:var(--brand-2); }
    .sq-btn.playing{ background:var(--accent); color:#222; }
    .sq-btn:focus{ outline:3px solid rgba(0,0,0,0.2); }
    audio.hidden-audio{ display:none !important; }

    /* Footer */
    footer {
      margin-top: 40px; padding: 12px 20px; background: var(--brand); color: #fff;
      display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem;
    }
    footer .home-btn-bottom { text-decoration: none; color: #fff; background: var(--brand-2);
      padding: 6px 12px; border-radius: 6px; }
    footer .home-btn-bottom:hover { background: #0077cc; }

    /* ---------- Responsive ---------- */
    @media (max-width: 820px){
      #part2-frame{ grid-template-columns: 1fr 280px; }
    }
    @media (max-width: 640px){
      #part2-frame{ grid-template-columns: 1fr; }
      #options{ position:static; max-height:none; }
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" class="home-btn-top">üè† Home</a>
    <h1>PTE Describe Situation + Plus</h1>
    <p>A mixed Academic Exam and Soft Skills lesson in 3 parts.</p>
  </header>

  <main>
    <!-- ================== PART 1 ================== -->
    <h2>Part 1. Write the situation from dictation.</h2>

    <div class="question">
      <label for="q1">Situation 1</label>
      <div class="audio-row">
        <button class="sq-btn" data-audio="#p1s1" aria-label="Play Situation 1">‚ñ∂</button>
        <audio id="p1s1"><source src="Situation1.mp3" type="audio/mpeg"></audio>
      </div>
      <textarea id="q1" placeholder="Type exactly what you hear..."></textarea>
      <button onclick="checkSingleAnswer('q1')">Submit Answer</button>
      <div id="result-q1" class="result-box"></div>
    </div>

    <div class="question">
      <label for="q2">Situation 2</label>
      <div class="audio-row">
        <button class="sq-btn" data-audio="#p1s2" aria-label="Play Situation 2">‚ñ∂</button>
        <audio id="p1s2"><source src="Situation2.mp3" type="audio/mpeg"></audio>
      </div>
      <textarea id="q2" placeholder="Type exactly what you hear..."></textarea>
      <button onclick="checkSingleAnswer('q2')">Submit Answer</button>
      <div id="result-q2" class="result-box"></div>
    </div>

    <div class="question">
      <label for="q3">Situation 3</label>
      <div class="audio-row">
        <button class="sq-btn" data-audio="#p1s3" aria-label="Play Situation 3">‚ñ∂</button>
        <audio id="p1s3"><source src="Situation3.mp3" type="audio/mpeg"></audio>
      </div>
      <textarea id="q3" placeholder="Type exactly what you hear..."></textarea>
      <button onclick="checkSingleAnswer('q3')">Submit Answer</button>
      <div id="result-q3" class="result-box"></div>
    </div>

    <!-- ================== PART 2 ================== -->
    <h2>Part 2. Match each Situation to the correct Response</h2>
    <p>Drag the correct response into the box next to its matching situation. Only the correct answer will stay. <br>There 3 extra.</p>

    <div id="part2-frame">
      <!-- Situations column -->
      <div id="situations">

        <div class="match-item">
          <label>Situation 4</label>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#s4" aria-label="Play Situation 4">‚ñ∂</button>
            <audio id="s4"><source src="Situation4.mp3" type="audio/mpeg"></audio>
          </div>
          <div class="dropzone" id="dz-q4" ondrop="drop(event,'q4')" ondragover="allowDrop(event)">Drop Response Here</div>
        </div>

        <div class="match-item">
          <label>Situation 5</label>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#s5" aria-label="Play Situation 5">‚ñ∂</button>
            <audio id="s5"><source src="Situation5.mp3" type="audio/mpeg"></audio>
          </div>
          <div class="dropzone" id="dz-q5" ondrop="drop(event,'q5')" ondragover="allowDrop(event)">Drop Response Here</div>
        </div>

        <div class="match-item">
          <label>Situation 6</label>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#s6" aria-label="Play Situation 6">‚ñ∂</button>
            <audio id="s6"><source src="Situation6.mp3" type="audio/mpeg"></audio>
          </div>
          <div class="dropzone" id="dz-q6" ondrop="drop(event,'q6')" ondragover="allowDrop(event)">Drop Response Here</div>
        </div>
      </div>

      <!-- Responses column (sticky) -->
      <div id="options">
        <div id="r1" class="option" draggable="true" ondragstart="drag(event)">
          <strong>üéß Response A</strong>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#ra" aria-label="Play Response A">‚ñ∂</button>
            <audio id="ra"><source src="Response3.m4a" type="audio/mpeg"></audio>
          </div>
        </div>

        <div id="r2" class="option" draggable="true" ondragstart="drag(event)">
          <strong>üéß Response B</strong>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#rb" aria-label="Play Response B">‚ñ∂</button>
            <audio id="rb"><source src="Response6.m4a" type="audio/mpeg"></audio>
          </div>
        </div>

        <div id="r3" class="option" draggable="true" ondragstart="drag(event)">
          <strong>üéß Response C</strong>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#rc" aria-label="Play Response C">‚ñ∂</button>
            <audio id="rc"><source src="Extra3.m4a" type="audio/mpeg"></audio>
          </div>
        </div>

        <div id="r4" class="option" draggable="true" ondragstart="drag(event)">
          <strong>üéß Response D</strong>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#rd" aria-label="Play Response D">‚ñ∂</button>
            <audio id="rd"><source src="Response2.m4a" type="audio/mpeg"></audio>
          </div>
        </div>

        <div id="r5" class="option" draggable="true" ondragstart="drag(event)">
          <strong>üéß Response E</strong>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#re" aria-label="Play Response E">‚ñ∂</button>
            <audio id="re"><source src="Response5.m4a" type="audio/mpeg"></audio>
          </div>
        </div>

        <div id="r6" class="option" draggable="true" ondragstart="drag(event)">
          <strong>üéß Response F</strong>
          <div class="audio-row">
            <button class="sq-btn" data-audio="#rf" aria-label="Play Response F">‚ñ∂</button>
            <audio id="rf"><source src="Response1.m4a" type="audio/mpeg"></audio>
          </div>
          <p> Now listen to the 3 Extra Answers and imagine the situation question</p>
        </div>
      </div>
    </div>

    <!-- ================== PART 3 ================== -->
    <h2>Part 3. Gapfill Listening</h2>
    <p>Listen to the sample describe situation questions and responses, then complete the gapfills.</p>

    <div class="gapfill">
      <label><strong>a. Situation:</strong></label>
      <div class="audio-row">
        <button class="sq-btn" data-audio="#p3a" aria-label="Play Part 3 A">‚ñ∂</button>
        <audio id="p3a"><source src="amixdown.mp3" type="audio/mpeg"></audio>
      </div>
      <p>
        You were supposed to 1. <input type="text" id="a1"> a group presentation today, 
        but one member didn‚Äôt complete their part. You need to 2. <input type="text" id="a2"> 
        this to your professor. What do you say?
      </p>
      <p><strong>Response:</strong>  
        "Hello Professor, we were 3. <input type="text" id="a3"> to present today,  
        but 4. <input type="text" id="a4"> one of our group members wasn‚Äôt able to complete  
        their section due to personal 5. <input type="text" id="a5">.  
        The rest of us are fully prepared, and we‚Äôd be happy to present our parts now  
        or reschedule if that‚Äôs more 6. <input type="text" id="a6">.  
        We‚Äôre committed to delivering a complete and 7. <input type="text" id="a7"> presentation."
      </p>
      <button onclick="checkPart3('a')">Submit Part 3a</button>
      <div id="results-a" class="results"></div>
    </div>

    <div class="gapfill">
      <label><strong>b. Situation:</strong></label>
      <div class="audio-row">
        <button class="sq-btn" data-audio="#p3b" aria-label="Play Part 3 B">‚ñ∂</button>
        <audio id="p3b"><source src="bmixdown.mp3" type="audio/mpeg"></audio>
      </div>
      <p>
        You were supposed to 1. <input type="text" id="b1"> a tutorial,  
        but you accidentally went to the wrong classroom.  
        You‚Äôre now 2. <input type="text" id="b2"> this to your tutor. What do you say?
      </p>
      <p><strong>Response:</strong>  
        "Well this is a bit embarrassing, I‚Äôm really sorry I missed today‚Äôs tutorial.  
        I accidentally went to the wrong room and didn‚Äôt 3. <input type="text" id="b3"> until it was too late.  
        I‚Äôve already reviewed the materials online, but I‚Äôd appreciate any notes or updates I might‚Äôve missed.  
        I‚Äôll make 4. <input type="text" id="b4"> it doesn‚Äôt happen again."
      </p>
      <button onclick="checkPart3('b')">Submit Part 3b</button>
      <div id="results-b" class="results"></div>
    </div>
  </main>

  <footer>
    <a href="index.html" class="home-btn-bottom">üè† Home</a>
    <span>¬© justinerkelly2025</span>
  </footer>

  <script>
    /* ---------- Part 1 checking (same logic) ---------- */
    const correctAnswers = {
      q1: "Situation 1: Your classmate forgot their homework and asks you to cover for them. (What do you say?)",
      q2: "Situation 2: You missed your flight due to traffic. You‚Äôre speaking to the airline staff. (What do you say?)",
      q3: "Situation 3: You received feedback on your assignment that you think is unfair. You want to speak to your lecturer about it. (What do you say?)"
    };
    const contractions = {
      "you're":"you are","youre":"you are","don't":"do not","dont":"do not",
      "doesn't":"does not","doesnt":"does not","can't":"cannot","cant":"cannot",
      "i'm":"i am","im":"i am","it's":"it is","its":"it is","they're":"they are",
      "theyre":"they are","we're":"we are","were":"we are","wouldn't":"would not",
      "wouldnt":"would not","shouldn't":"should not","shouldnt":"should not",
      "couldn't":"could not","couldnt":"could not"
    };
    function expandContractions(str){ return str.split(/\s+/).map(w=>contractions[w.toLowerCase()]||w).join(" "); }
    function normalizeAnswer(text){ return text.replace(/\(What do you say\?\)/gi,"").trim(); }
    function highlightDiff(userAns, correctAns){
      let uWords = userAns.split(/\s+/); let cWords = correctAns.split(/\s+/);
      return cWords.map((word,i)=> (uWords[i] && uWords[i].toLowerCase()===word.toLowerCase()) ? word : `<span class="highlight">${word}</span>` ).join(" ");
    }
    function checkSingleAnswer(qId){
      let userAns=document.getElementById(qId).value.trim();
      let correctAns=normalizeAnswer(correctAnswers[qId]);
      let normUser=expandContractions(userAns).toLowerCase();
      let normCorrect=expandContractions(correctAns).toLowerCase();
      let feedback = (normUser===normCorrect)
        ? `<p>‚úÖ Correct<br><strong>Score: 1/1</strong></p>`
        : `
          <p>‚ùå Incorrect<br><strong>Score: 0/1</strong></p>
          <table>
            <tr><th>Your Answer</th><th>Correct Answer</th></tr>
            <tr><td>${userAns || "(no answer)"}</td>
                <td>${highlightDiff(expandContractions(userAns), correctAns)} <span class="optional">(What do you say?)</span></td></tr>
          </table>`;
      let box=document.getElementById("result-"+qId);
      box.innerHTML=feedback; box.style.display="block";
    }

    /* ---------- Part 2 DnD (correct mapping) ---------- */
    // 1‚ÜíF, 2‚ÜíD, 3‚ÜíC, 4‚ÜíA, 5‚ÜíE, 6‚ÜíB
    const correctMatches = { q1:"r6", q2:"r4", q3:"r3", q4:"r1", q5:"r5", q6:"r2" };
    function allowDrop(ev){ ev.preventDefault(); }
    function drag(ev){
      const el = ev.target.closest('.option');
      if(!el) return;
      ev.dataTransfer.setData("text/plain", el.id);
    }
    function drop(ev,qId){
      ev.preventDefault();
      const dz = ev.currentTarget;
      const id = ev.dataTransfer.getData("text/plain");
      const card = document.getElementById(id);
      if(!card) return;
      if(id===correctMatches[qId]){
        dz.innerHTML = "";
        dz.appendChild(card);
        dz.style.border = "2px solid green";
        dz.style.color = "#000";
        dz.style.fontStyle = "normal";
      } else {
        document.getElementById("options").appendChild(card);
        dz.style.border = "2px dashed #d93025";
      }
    }

    /* ---------- Square Players: global custom controls + auto-stop ---------- */
    const allAudios = [];
    function stopAllExcept(skip){
      allAudios.forEach(({audio,btn})=>{
        if(audio!==skip){
          audio.pause(); audio.currentTime = 0;
          btn.classList.remove('playing'); btn.textContent = "‚ñ∂";
        }
      });
    }
    function initSquarePlayers(){
      document.querySelectorAll('.sq-btn').forEach(btn=>{
        const targetSel = btn.getAttribute('data-audio');
        const audio = document.querySelector(targetSel);
        if(!audio) return;
        // hide native controls if present
        audio.removeAttribute('controls');
        audio.classList.add('hidden-audio');

        // register
        allAudios.push({audio,btn});

        // click to toggle
        btn.addEventListener('click', ()=>{
          if(audio.paused){
            stopAllExcept(audio);
            audio.play();
            btn.classList.add('playing');
            btn.textContent = "‚ùö‚ùö";
          } else {
            audio.pause();
            btn.classList.remove('playing');
            btn.textContent = "‚ñ∂";
          }
        });

        // when audio ends, reset button
        audio.addEventListener('ended', ()=>{
          btn.classList.remove('playing');
          btn.textContent = "‚ñ∂";
        });

        // also pause others if this starts (covers keyboard/screenreader play)
        audio.addEventListener('play', ()=> stopAllExcept(audio));
      });
    }

    /* ---------- Part 3 checking ---------- */
    const part3Answers = {
      a1:["submit"], a2:["explain"], a3:["scheduled"],
      a4:["unfortunately"], a5:["issues"], a6:["appropriate"], a7:["cohesive"],
      b1:["attend"], b2:["explaining"], b3:["realise","realize"], b4:["sure"]
    };
    function checkPart3(section){
      let score=0;
      const keys = Object.keys(part3Answers).filter(k=>k.startsWith(section));
      let out = `<h3>Results for Part 3${section.toUpperCase()}</h3>`;
      keys.forEach(k=>{
        const user = (document.getElementById(k).value||"").trim().toLowerCase();
        const ok = part3Answers[k].map(v=>v.toLowerCase());
        if(ok.includes(user)){ score++; out += `<p>${k.toUpperCase()}: ‚úÖ Correct</p>`; }
        else{
          out += `<p>${k.toUpperCase()}: ‚ùå Your answer: "${user||"(blank)"}"<br>
                  Correct answer: <span class="highlight">${part3Answers[k].join(" / ")}</span></p>`;
        }
      });
      out = `<p><strong>Score: ${score}/${keys.length}</strong></p>` + out;
      const box = document.getElementById("results-"+section);
      box.innerHTML = out; box.style.display="block";
    }

    // boot
    initSquarePlayers();
  </script>
</body>
</html>
